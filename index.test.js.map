{"version":3,"sources":["../src/index.test.js"],"names":["Index","proxyquire","noCallThru","load","sleep","time","Promise","resolve","setTimeout","createDeferredStub","observable","sinon","stub","returns","subscribe","handler","test","afterEach","always","restore","t","plan","id","result","instanceStub","rpc","sendAndObserveResponse","AppProxyHandler","get","value","is","true","calledOnceWith","networkDetails","type","networkFn","AppProxy","prototype","network","jsonrpc","sendAndObserveResponses","call","deepEqual","truthy","accountsFn","accounts","currentApp","appAddress","appId","appImplementationAddress","identifier","isForwarder","kernelAddress","name","currentAppFn","icon","undefined","initialApps","endApps","concat","installedAppsFn","installedApps","emitIndex","forEach","app","fail","identifyFn","identify","send","pathFn","path","requestPathFn","requestPath","eventsFn","events","fromBlock","externalFn","external","observableEvents","jsonInterfaceStub","eventsObservable","observableCall","constant","callResult","grantPermission","observableIntent","intentResult","add","stateFn","state","stateObservable","Subject","counter","next","storeFn","store","cache","getCache","pastEvents","web3Eth","withArgs","reducer","action","actionHistory","event","push","payload","blockNumber","callFn","describeScriptFn","describeScript","web3EthFn","registerAppMetadataFn","registerAppMetadata","getCall","args","queryAppMetadataFn","queryAppMetadata","from","to","dataId","cid","getAppMetadataFn","getAppMetadata","newActionFn","newForwardedAction","updateActionFn","updateForwardedAction","instanceStub2","getFwdActionsFn","getForwardedActions","returnValues","triggerFn","trigger","testprop"],"mappings":"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","sourcesContent":["import test from 'ava'\nimport sinon from 'sinon'\nimport proxyquire from 'proxyquire'\nimport { defer, from, of, Subject } from 'rxjs'\n\nconst Index = proxyquire.noCallThru().load('./index', {\n  '@aragon/rpc-messenger': {}\n})\n\nasync function sleep (time) {\n  return new Promise(resolve => setTimeout(resolve, time))\n}\n\nfunction createDeferredStub (observable) {\n  return sinon.stub().returns(defer(() => observable))\n}\n\nfunction subscribe (observable, handler) {\n  // Mimic an async delay to test the deferred behaviour\n  sleep(10)\n  observable.subscribe(handler)\n}\n\ntest.afterEach.always(() => {\n  sinon.restore()\n})\n\ntest('should send intent when the method does not exist in target', t => {\n  t.plan(2)\n  // arrange\n  const observable = of({\n    id: 'uuid1',\n    result: 10\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = Index.AppProxyHandler.get(instanceStub, 'add')(5)\n  // assert\n  subscribe(result, value => {\n    t.is(value, 10)\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('intent', ['add', 5]))\n})\n\ntest('should return the network details as an observable', t => {\n  t.plan(2)\n  // arrange\n  const networkDetails = {\n    id: 4,\n    type: 'rinkeby'\n  }\n  const networkFn = Index.AppProxy.prototype.network\n  const observable = of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: networkDetails\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = networkFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, networkDetails)\n  })\n  t.truthy(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('network'))\n})\n\ntest('should return the accounts as an observable', t => {\n  t.plan(2)\n  // arrange\n  const accountsFn = Index.AppProxy.prototype.accounts\n  const observable = of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: ['accountX', 'accountY', 'accountZ']\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = accountsFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, ['accountX', 'accountY', 'accountZ'])\n  })\n  t.truthy(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('accounts'))\n})\n\ntest('should send a getApps request for the current app and observe the single response', t => {\n  t.plan(3)\n\n  const currentApp = {\n    appAddress: '0x456',\n    appId: 'counterApp',\n    appImplementationAddress: '0xcounterApp',\n    identifier: 'counter',\n    isForwarder: false,\n    kernelAddress: '0x123',\n    name: 'Counter'\n  }\n\n  // arrange\n  const currentAppFn = Index.AppProxy.prototype.currentApp\n  const observable = of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: currentApp\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = currentAppFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    t.is(value.icon(), undefined)\n    delete value.icon\n\n    t.deepEqual(value, currentApp)\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('get_apps'))\n})\n\ntest('should send a getApps request for installed apps and observe the response', t => {\n  const initialApps = [{\n    appAddress: '0x123',\n    appId: 'kernel',\n    appImplementationAddress: '0xkernel',\n    identifier: undefined,\n    isForwarder: false,\n    kernelAddress: undefined,\n    name: 'Kernel'\n  }]\n  const endApps = [].concat(initialApps, {\n    appAddress: '0x456',\n    appId: 'counterApp',\n    appImplementationAddress: '0xcounterApp',\n    identifier: 'counter',\n    isForwarder: false,\n    kernelAddress: '0x123',\n    name: 'Counter'\n  })\n\n  // arrange\n  const installedAppsFn = Index.AppProxy.prototype.installedApps\n  const observable = of(\n    {\n      jsonrpc: '2.0',\n      id: 'uuid1',\n      result: initialApps\n    }, {\n      jsonrpc: '2.0',\n      id: 'uuid1',\n      result: endApps\n    }\n  )\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = installedAppsFn.call(instanceStub)\n  // assert\n  let emitIndex = 0\n  subscribe(result, value => {\n    value.forEach(app => {\n      t.is(app.icon(), undefined)\n      delete app.icon\n    })\n\n    if (emitIndex === 0) {\n      t.deepEqual(value, initialApps)\n    } else if (emitIndex === 1) {\n      t.deepEqual(value, endApps)\n    } else {\n      t.fail('too many emissions')\n    }\n\n    emitIndex++\n  })\n\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('get_apps'))\n})\n\ntest('should send an identify request', t => {\n  t.plan(1)\n  // arrange\n  const identifyFn = Index.AppProxy.prototype.identify\n  const instanceStub = {\n    rpc: {\n      send: sinon.stub()\n    }\n  }\n  // act\n  identifyFn.call(instanceStub, 'ANT')\n  // assert\n  t.true(instanceStub.rpc.send.calledOnceWith('identify', ['ANT']))\n})\n\ntest('should send a path request and observe the response', t => {\n  t.plan(3)\n  // arrange\n  const pathFn = Index.AppProxy.prototype.path\n  const observable = of(\n    {\n      jsonrpc: '2.0',\n      id: 'uuid1',\n      result: 'path1'\n    }, {\n      jsonrpc: '2.0',\n      id: 'uuid1',\n      result: 'path2'\n    }\n  )\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = pathFn.call(instanceStub)\n  // assert\n  let emitIndex = 0\n  subscribe(result, value => {\n    if (emitIndex === 0) {\n      t.deepEqual(value, 'path1')\n    } else if (emitIndex === 1) {\n      t.deepEqual(value, 'path2')\n    } else {\n      t.fail('too many emissions')\n    }\n\n    emitIndex++\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('path', ['observe']))\n})\n\ntest('should send a path modification request', t => {\n  t.plan(2)\n  // arrange\n  const path = 'new_path'\n  const requestPathFn = Index.AppProxy.prototype.requestPath\n  const observable = of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: null\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = requestPathFn.call(instanceStub, path)\n  // assert\n  subscribe(result, value => t.is(value, null))\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('path', ['modify', path]))\n})\n\ntest('should return the events observable', t => {\n  t.plan(2)\n  // arrange\n  const eventsFn = Index.AppProxy.prototype.events\n  const observable = of({\n    id: 'uuid1',\n    result: ['eventA', 'eventB']\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = eventsFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, ['eventA', 'eventB'])\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('events', ['allEvents', {}]))\n})\n\ntest('should return an handle for an external contract events', t => {\n  t.plan(2)\n  const fromBlock = 2\n\n  // arrange\n  const externalFn = Index.AppProxy.prototype.external\n  const observableEvents = of({\n    id: 'uuid1',\n    result: { name: 'eventA', value: 3000 }\n  })\n  const jsonInterfaceStub = [\n    { type: 'event', name: 'SetPermission' }\n  ]\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observableEvents)\n    }\n  }\n  // act\n  const result = externalFn.call(instanceStub, '0xextContract', jsonInterfaceStub)\n  // events from starting block\n  const eventsObservable = result.events({ fromBlock })\n  // assert\n  subscribe(eventsObservable, value => {\n    t.deepEqual(value, { name: 'eventA', value: 3000 })\n  })\n  t.true(\n    instanceStub.rpc.sendAndObserveResponses.calledOnceWith(\n      'external_events',\n      ['0xextContract', [jsonInterfaceStub[0]], 'allEvents', { fromBlock }]\n    )\n  )\n})\n\ntest('should return a handle for creating external calls', t => {\n  t.plan(2)\n  // arrange\n  const externalFn = Index.AppProxy.prototype.external\n  const observableCall = of({\n    id: 'uuid4',\n    result: 'bob was granted permission for the counter app'\n  })\n\n  const jsonInterfaceStub = [\n    { type: 'function', name: 'grantPermission', constant: true }\n  ]\n\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observableCall)\n    }\n  }\n\n  // act\n  const result = externalFn.call(instanceStub, '0xextContract', jsonInterfaceStub)\n  const callResult = result.grantPermission('0xbob', '0xcounter')\n\n  // assert\n  subscribe(callResult, value => {\n    t.is(value, 'bob was granted permission for the counter app')\n  })\n\n  t.true(\n    instanceStub.rpc.sendAndObserveResponse.calledOnceWith(\n      'external_call',\n      ['0xextContract', jsonInterfaceStub[0], '0xbob', '0xcounter']\n    )\n  )\n})\n\ntest('should return a handle for creating external transaction intents', t => {\n  t.plan(2)\n  // arrange\n  const externalFn = Index.AppProxy.prototype.external\n  const observableIntent = of({\n    id: 'uuid4',\n    result: 10\n  })\n\n  const jsonInterfaceStub = [\n    { type: 'function', name: 'add', constant: false }\n  ]\n\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observableIntent)\n    }\n  }\n\n  // act\n  const result = externalFn.call(instanceStub, '0xextContract', jsonInterfaceStub)\n  const intentResult = result.add(10)\n\n  // assert\n  subscribe(intentResult, value => {\n    t.is(value, 10)\n  })\n  t.true(\n    instanceStub.rpc.sendAndObserveResponse.calledOnceWith(\n      'external_intent',\n      ['0xextContract', jsonInterfaceStub[0], 10]\n    )\n  )\n})\n\ntest('should return the state from cache', t => {\n  t.plan(3)\n  // arrange\n  const stateFn = Index.AppProxy.prototype.state\n  const stateObservable = new Subject()\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(stateObservable)\n    }\n  }\n  // act\n  const result = stateFn.call(instanceStub)\n  // assert\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('cache', ['observe', 'state']))\n\n  let counter = 0\n  subscribe(result, value => {\n    if (counter === 0) {\n      t.deepEqual(value, { counter: 5 })\n    } else if (counter === 1) {\n      t.deepEqual(value, { counter: 6 })\n    }\n    counter++\n  })\n  // send state events\n  stateObservable.next({\n    id: 'uuid1',\n    result: { counter: 5 }\n  })\n  stateObservable.next({\n    id: 'uuid1',\n    result: { counter: 6 }\n  })\n})\n\ntest('should create a store and reduce correctly without previously cached state', async t => {\n  t.plan(2)\n  // arrange\n  const storeFn = Index.AppProxy.prototype.store\n  const observableEvents = new Subject()\n\n  const instanceStub = {\n    accounts: () => from([\n      ['0x0000000000000000000000000000000000000abc']\n    ]),\n    cache: () => of(),\n    events: createDeferredStub(observableEvents),\n    getCache: () => from([null]),\n    pastEvents: () => of([]),\n    web3Eth: sinon.stub().withArgs('getBlockNumber').returns(from(['4385398']))\n  }\n  const reducer = (state, action) => {\n    if (state === null) state = { actionHistory: [], counter: 0 }\n\n    switch (action.event) {\n      case 'Add':\n        state.actionHistory.push(action)\n        state.counter += action.payload\n        return state\n      case 'Subtract':\n        state.actionHistory.push(action)\n        state.counter -= action.payload\n        return state\n    }\n    return state\n  }\n  // act\n  const result = storeFn.call(instanceStub, reducer)\n  // assert\n  subscribe(result, value => {\n    if (value.counter === 2) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 2 }\n      ])\n    }\n    if (value.counter === 12) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 2 },\n        { event: 'Add', payload: 10 }\n      ])\n    }\n  })\n  // send events; wait to avoid grouping through debounce\n  await sleep(250)\n  observableEvents.next({ event: 'Add', payload: 2 })\n  await sleep(500)\n  observableEvents.next({ event: 'Add', payload: 10 })\n  await sleep(1000)\n})\n\ntest('should create a store and reduce correctly with previously cached state', async t => {\n  t.plan(2)\n  // arrange\n  const storeFn = Index.AppProxy.prototype.store\n  const observableEvents = new Subject()\n\n  const instanceStub = {\n    accounts: () => from([\n      ['0x0000000000000000000000000000000000000abc']\n    ]),\n    cache: () => of(),\n    events: createDeferredStub(observableEvents),\n    getCache: () => of({\n      state: {\n        actionHistory: [\n          { event: 'Add', payload: 5 }\n        ],\n        counter: 5\n      },\n      blockNumber: 1\n    }),\n    pastEvents: () => of([]),\n    web3Eth: sinon.stub().withArgs('getBlockNumber').returns(from(['4385398']))\n  }\n  const reducer = (state, action) => {\n    if (state === null) state = { actionHistory: [], counter: 0 }\n\n    switch (action.event) {\n      case 'Add':\n        state.actionHistory.push(action)\n        state.counter += action.payload\n        return state\n      case 'Subtract':\n        state.actionHistory.push(action)\n        state.counter -= action.payload\n        return state\n    }\n    return state\n  }\n  // act\n  const result = storeFn.call(instanceStub, reducer)\n  // assert\n  subscribe(result, value => {\n    if (value.counter === 5) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 5 }\n      ])\n    }\n    if (value.counter === 7) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 5 },\n        { event: 'Add', payload: 2 }\n      ])\n    }\n    if (value.counter === 17) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 5 },\n        { event: 'Add', payload: 2 },\n        { event: 'Add', payload: 10 }\n      ])\n    }\n  })\n  // send events; wait to avoid grouping through debounce\n  await sleep(250)\n  observableEvents.next({ event: 'Add', payload: 2 })\n  await sleep(500)\n  observableEvents.next({ event: 'Add', payload: 10 })\n  await sleep(500)\n})\n\ntest('should perform a call to the contract and observe the response', t => {\n  t.plan(2)\n  // arrange\n  const callFn = Index.AppProxy.prototype.call\n  const observable = of({\n    id: 'uuid1',\n    result: 'success'\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = callFn.call(instanceStub, 'transferEth', 10)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, 'success')\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('call', ['transferEth', 10]))\n})\n\ntest('should send a describeScript request and observe the response', t => {\n  t.plan(2)\n  // arrange\n  const describeScriptFn = Index.AppProxy.prototype.describeScript\n  const observable = of({\n    id: 'uuid1',\n    result: 'script executed'\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = describeScriptFn.call(instanceStub, 'goto fail')\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, 'script executed')\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('describe_script', ['goto fail']))\n})\n\ntest('should send a web3Eth function request and observe the response', t => {\n  t.plan(2)\n  // arrange\n  const web3EthFn = Index.AppProxy.prototype.web3Eth\n  const observable = of({\n    id: 'uuid1',\n    result: ['accountA', 'accountB']\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = web3EthFn.call(instanceStub, 'getAccounts', 5)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, ['accountA', 'accountB'])\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('web3_eth', ['getAccounts', 5]))\n})\n\ntest('should return the registerAppMetadata observable', t => {\n  t.plan(3)\n  // arrange\n  const registerAppMetadataFn = Index.AppProxy.prototype.registerAppMetadata\n  const instanceStub = {\n    rpc: {\n      send: sinon.stub()\n    }\n  }\n  // act\n  registerAppMetadataFn.call(instanceStub, '1', 'uuid1', 'QmrandomhashoceBBSBGmYiHVFQLHN8Uex6CeqExmp6Ggk', ['0xcafe'])\n  // assert\n  t.is(instanceStub.rpc.send.getCall(0).args[0], 'register_app_metadata')\n  t.deepEqual(instanceStub.rpc.send.getCall(0).args[1], ['1', 'uuid1', 'QmrandomhashoceBBSBGmYiHVFQLHN8Uex6CeqExmp6Ggk', ['0xcafe']])\n  // act and assert default 'to'\n  registerAppMetadataFn.call(instanceStub, '1', 'uuid2', 'QmrandomhashoceBBSBGmYiHVFQLHN8Uex6CeqExmp6GgK')\n  t.deepEqual(instanceStub.rpc.send.getCall(1).args[1], ['1', 'uuid2', 'QmrandomhashoceBBSBGmYiHVFQLHN8Uex6CeqExmp6GgK', ['*']])\n})\n\ntest('should return individual metadata entry', t => {\n  t.plan(3)\n\n  // arrange\n  const queryAppMetadataFn = Index.AppProxy.prototype.queryAppMetadata\n\n  const observable = of({\n    id: 'uuid1',\n    result: {\n      from: '0xfed',\n      to: [ '0xcafe', '0xdeaddead' ],\n      dataId: 'u2',\n      cid: 'Qmrandomhash'\n    } })\n\n  const instanceStub = {\n    rpc: {\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n\n  // act\n  const result = queryAppMetadataFn.call(instanceStub, 'a', '1')\n\n  // assert\n  t.is(instanceStub.rpc.sendAndObserveResponse.getCall(0).args[0], 'query_app_metadata')\n  t.deepEqual(instanceStub.rpc.sendAndObserveResponse.getCall(0).args[1], ['a', '1'])\n\n  result.subscribe(value => {\n    t.deepEqual(value, {\n      from: '0xfed',\n      to: [ '0xcafe', '0xdeaddead' ],\n      dataId: 'u2',\n      cid: 'Qmrandomhash'\n    })\n  })\n})\n\ntest('should return appMetadata observable', t => {\n  t.plan(3)\n\n  // arrange\n  const getAppMetadataFn = Index.AppProxy.prototype.getAppMetadata\n\n  const observable = from([{\n    event: 'AppMetadata',\n    result: {\n      from: '0xfed',\n      to: [ '0xcafe', '0xdeaddead' ],\n      dataId: 'u2',\n      cid: 'Qmrandomhash'\n    }\n  }])\n  const instanceStub = {\n    rpc: {\n      sendAndObserveResponses: sinon.stub().returns(observable)\n    }\n  }\n  // act\n  const result = getAppMetadataFn.call(instanceStub)\n  // assert\n  t.truthy(instanceStub.rpc.sendAndObserveResponses.getCall(0))\n\n  result.subscribe(value => {\n    t.deepEqual(value, {\n      from: '0xfed',\n      to: [ '0xcafe', '0xdeaddead' ],\n      dataId: 'u2',\n      cid: 'Qmrandomhash'\n    })\n  })\n\n  t.is(instanceStub.rpc.sendAndObserveResponses.getCall(0).args[0], 'get_app_metadata')\n})\ntest('should submit a new action', t => {\n  t.plan(2)\n  // arrange\n  const newActionFn = Index.AppProxy.prototype.newForwardedAction\n  const instanceStub = {\n    rpc: {\n      send: sinon.stub()\n    }\n  }\n  // act\n  newActionFn.call(instanceStub, '0', '49', 'testScript')\n  // assert\n  t.is(instanceStub.rpc.send.getCall(0).args[0], 'update_forwarded_action')\n  t.deepEqual(instanceStub.rpc.send.getCall(0).args[1], ['0', '49', 'testScript'])\n})\n\ntest('should update an action', t => {\n  t.plan(4)\n  // arrange\n  const updateActionFn = Index.AppProxy.prototype.updateForwardedAction\n  const instanceStub = {\n    rpc: {\n      send: sinon.stub()\n    }\n  }\n  const instanceStub2 = {\n    rpc: {\n      send: sinon.stub()\n    }\n  }\n  // act\n  updateActionFn.call(instanceStub, '1', '49', 'testScript', '0')\n  // assert\n  t.is(instanceStub.rpc.send.getCall(0).args[0], 'update_forwarded_action')\n  t.deepEqual(instanceStub.rpc.send.getCall(0).args[1], ['1', '49', 'testScript', '0'])\n\n  // act\n  updateActionFn.call(instanceStub2, '2', '49', 'updatedScript', '1')\n  // assert\n  t.is(instanceStub2.rpc.send.getCall(0).args[0], 'update_forwarded_action')\n  t.deepEqual(instanceStub2.rpc.send.getCall(0).args[1], ['2', '49', 'updatedScript', '1'])\n})\n\ntest('should return the forwardedActions observable', t => {\n  t.plan(3)\n  // arrange\n  const getFwdActionsFn = Index.AppProxy.prototype.getForwardedActions\n  const observable = of({\n    event: 'uuid1',\n    result: {\n      event: 'ForwardedActions',\n      returnValues: ['forwardedAction1', 'forwardedAction2']\n    }\n  })\n  const instanceStub = {\n    rpc: {\n      sendAndObserveResponses: sinon.stub()\n        .returns(observable)\n    }\n  }\n  // act\n  const result = getFwdActionsFn.call(instanceStub)\n  // assert\n  // the call to sendAndObserveResponse should not be defered until we subscribe,\n  // since we are working with a BehaviorSubject and just want the latest and greatest\n  t.truthy(instanceStub.rpc.sendAndObserveResponses.getCall(0))\n  result.subscribe(value => {\n    t.deepEqual(value, {\n      event: 'ForwardedActions',\n      returnValues: ['forwardedAction1', 'forwardedAction2']\n    })\n  })\n  t.is(instanceStub.rpc.sendAndObserveResponses.getCall(0).args[0], 'get_forwarded_actions')\n})\n\ntest('should send a trigger request to the wrapper', t => {\n  t.plan(2)\n  // arrange\n  const triggerFn = Index.AppProxy.prototype.trigger\n  const instanceStub = {\n    rpc: {\n      send: sinon.stub()\n    }\n  }\n  // act\n  triggerFn.call(instanceStub, 'TriggerTest', { testprop: '123abc' })\n  // assert\n  t.is(instanceStub.rpc.send.getCall(0).args[0], 'trigger')\n  t.deepEqual(instanceStub.rpc.send.getCall(0).args[1], ['TriggerTest', { testprop: '123abc' }])\n})\n"],"file":"index.test.js"}